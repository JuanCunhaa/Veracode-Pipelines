{"tasks":[{"environment":{"SRCCLR_API_TOKEN":"$(SRCCLR_API_TOKEN)"},"displayName":"SCA","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"echo \"🔍 Rodando Veracode SCA...\"\ncurl -sSL https://download.sourceclear.com/ci.sh | bash -s -- scan","workingDirectory":"","failOnStderr":"false","bashEnvValue":""},"task":{"id":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","versionSpec":"3.*","definitionType":"task"}},{"environment":{},"displayName":"veracode package","alwaysRun":false,"continueOnError":true,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"mkdir -p artifacts\n\n          echo \"🔍 Verificando arquivos .jar/.war no target/\"\n          WAR_FILE=$(find target/ -maxdepth 1 -name \"*.war\" 2>/dev/null | head -n 1)\n          JAR_FILE=$(find target/ -maxdepth 1 -name \"*.jar\" 2>/dev/null | head -n 1)\n\n          if [ -f \"$WAR_FILE\" ]; then\n            echo \"✅ WAR encontrado: $WAR_FILE\"\n            cp \"$WAR_FILE\" artifacts/\n          elif [ -f \"$JAR_FILE\" ]; then\n            echo \"✅ JAR encontrado: $JAR_FILE\"\n            cp \"$JAR_FILE\" artifacts/\n          else\n            echo \"⚠️ Nenhum .war ou .jar encontrado. Gerando analysisPack.zip via Veracode CLI...\"\n\n            curl -fsS https://tools.veracode.com/veracode-cli/install | sh\n            ./veracode configure --api-id \"$(APIID)\" --api-key \"$(APIKEY)\"\n            ./veracode package --source . --output $(Build.ArtifactStagingDirectory)/artifact --trust --verbose\n          fi","workingDirectory":"","failOnStderr":"false","bashEnvValue":""},"task":{"id":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","versionSpec":"3.*","definitionType":"task"}},{"environment":{},"displayName":"Compilador","alwaysRun":false,"continueOnError":true,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"set -e\n \ncd \"$(Build.ArtifactStagingDirectory)/artifact\"\n \nmkdir -p merged\n \necho \"Procurando arquivos .zip em $(Build.ArtifactStagingDirectory)/artifact\"\nshopt -s nullglob\nzips=( *.zip )\nif [ ${#zips[@]} -gt 0 ]; then\n  for zip in \"${zips[@]}\"; do\n    echo \"Extraindo $zip para merged/\"\n    unzip -oq \"$zip\" -d merged/\n  done\nelse\n  echo \"Nenhum arquivo .zip encontrado.\"\nfi\n \nfor item in *; do\n  if [[ \"$item\" != \"merged\" && \"$item\" != *.zip ]]; then\n    echo \"Movendo $item para merged/\"\n    mv \"$item\" merged/\n  fi\ndone\n \necho \"Compactando tudo em analysisPack.zip\"\nrm -f /tmp/analysisPack.zip\n(cd merged && zip -qr /tmp/analysisPack.zip .)\n \necho \"Limpando $(Build.ArtifactStagingDirectory)/artifact\"\nrm -rf ./*\n \nmv /tmp/analysisPack.zip ./analysisPack.zip\n \necho \"Novo pacote pronto: $(Build.ArtifactStagingDirectory)/artifact/analysisPack.zip\"","workingDirectory":"","failOnStderr":"false","bashEnvValue":""},"task":{"id":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","versionSpec":"3.*","definitionType":"task"}},{"environment":{},"displayName":"Veracode Pipeline Scan","alwaysRun":false,"continueOnError":true,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"inputs":{"targetType":"inline","filePath":"","arguments":"","script":"set -euo pipefail\n\nART=\"$(Build.ArtifactStagingDirectory)/artifact/analysisPack.zip\"\n\necho \"Running Veracode Pipeline Scan CLI...\"\ncurl -sSLo pipeline-scan-LATEST.zip https://downloads.veracode.com/securityscan/pipeline-scan-LATEST.zip\nunzip -oq pipeline-scan-LATEST.zip -d pipeline-scan\n\njava -jar pipeline-scan/pipeline-scan.jar \\\n  -vid \"$APIID\" \\\n  -vkey \"$APIKEY\" \\\n  -f \"$ART\" \\\n  --json_output true \\\n  --issue_details true\n\necho \"✅ Pipeline Scan finalizado.\"","workingDirectory":"","failOnStderr":"false","bashEnvValue":""},"task":{"id":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","versionSpec":"3.*","definitionType":"task"}},{"environment":{},"displayName":"Upload and scan: $(Build.ArtifactStagingDirectory)/artifact","alwaysRun":false,"continueOnError":true,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"retryCountOnTaskFailure":0,"inputs":{"ConnectionDetailsSelection":"Credentials","AnalysisService":"","apiId":"$(APIID)","apiKey":"$(APIKEY)","veracodeAppProfile":"$(Build.Repository.Name)","version":"$(build.buildNumber)","filepath":"$(Build.ArtifactStagingDirectory)/artifact","sandboxName":"","createSandBox":"false","optargs":"-deleteincompletescan 2","createProfile":"true","failBuildIfUploadAndScanBuildStepFails":"false","importResults":"false","failBuildOnPolicyFail":"true","maximumWaitTime":"360"},"task":{"id":"6292a058-d4f5-407b-b6c6-815df9ee59d6","versionSpec":"3.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":3,"createdBy":{"displayName":"Juan Cunha","id":"6f2a07bd-8f1e-6a7b-981d-a87d11bd773a","uniqueName":"juan.cunha@afrikatec.com.br"},"createdOn":"2025-08-15T23:35:24.770Z","modifiedBy":{"displayName":"Juan Cunha","id":"6f2a07bd-8f1e-6a7b-981d-a87d11bd773a","uniqueName":"juan.cunha@afrikatec.com.br"},"modifiedOn":"2025-08-18T13:09:09.713Z","comment":"","id":"51667aa9-8a2e-43bf-b0fa-3f0fd4cd9735","name":"VERACODE - LIN","version":{"major":1,"minor":0,"patch":0,"isTest":false},"friendlyName":"VERACODE - LIN","category":"Deploy","definitionType":"metaTask","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"APIID","label":"APIID","defaultValue":"$(APIID)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"APIKEY","label":"APIKEY","defaultValue":"$(APIKEY)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"find target/ -maxdepth 1 -name \"*.jar\" 2>/dev/null | head -n 1","label":"find target/ -maxdepth 1 -name \"*.jar\" 2>/dev/null | head -n 1","defaultValue":"$(JAR_FILE)","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"find target/ -maxdepth 1 -name \"*.war\" 2>/dev/null | head -n 1","label":"find target/ -maxdepth 1 -name \"*.war\" 2>/dev/null | head -n 1","defaultValue":"$(WAR_FILE)","required":true,"type":"string","helpMarkDown":"","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: VERACODE - LIN $(APIID)","preJobExecution":{},"execution":{},"postJobExecution":{},"_buildConfigMapping":{}}